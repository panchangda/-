<!--pages/myMap/myMap.wxml-->
<page-meta scroll-top="{{pageMetaScrollTop}}"></page-meta>
<view class="container">
  <van-search value="{{chosenLocation}}" placeholder="请输入搜索关键词" bind:change="get_suggestion"
    bind:clear="clear_search" />
  <scroll-view class="search-page" scroll-y="true" style="height:{{showSelect?800:0}}rpx;  border:{{showSelect?5:0}}rpx solid black;">
    <!--绑定回填事件-->
    <view class="search-results" wx:for="{{suggestion}}" wx:key="index">
      <!--根据需求渲染相应数据 渲染地址title-->
      <view class="font-results" bind:tap="add_location" id="{{index}}">
        <view>{{item.title}}</view>
        <view style="font-size:12px;color:#666;">{{item.addr}}</view>
      </view>
      <image class="location-icon" src="../../resources/icons8-near-me-81.png" bindtap="show_onMap" mode="scaleToFill"></image>
    </view>
  </scroll-view>

  <view style="margin: 4rpx;">
    <wxp-drag id="drag" generic:item="wxp-drag-item" bind:delete="itemDelete" bind:click="itemClick"
      bind:change="change" bind:sortend="sortEnd" bind:scroll="scroll" item-wrap-class="drag-item-wrap"
      extra-nodes="{{extraNodes}}" list-data="{{listData}}" columns="{{size}}" scroll-top="{{scrollTop}}"
      item-height="{{(750 - 8) / size}}" top-size="80" bottom-size="0">
    </wxp-drag>
  </view>

  <image src="../../resources/icons8-double-up.gif" class="icon-double-up" bindtap="show_subpage"></image>
</view>

<page-container class="container" show="{{showSubPage}}" overlay="true" position="bottom"
  close-on-slide-down="{{false}}" custom-style="z-index:1;height:100%"
  overlay-style="background-color: rgba(255, 255, 255, 0.7)" bind:afterenter="FUCKYOUWXSHITAPI" >
  <!-- 日期选择 -->
  <view class="switch-date">
    <image src="../../resources/calendar.gif" style="width:80rpx;height:80rpx;"></image>
    <van-cell value="{{ date }}" bind:click="onCalendarDisplay" />
    <image src="../../resources/calendar.gif" style="width:80rpx;height:80rpx;"></image>
    <van-calendar show="{{showCalendar}}" show-confirm="{{ false }}" bind:close="onCalendarClose"
      bind:confirm="onCalendarConfirm" show-mark="{{true}}" position="bottom" default-date="{{todayDate}}"
      min-date="{{ minDate }}" max-date="{{ maxDate }}" />
  </view>
  <!-- 两侧箭头 -->
    <image bind:tap="load_yesterday" src="../../resources/icons8-back-64.png" class="icon-on-left"></image>
    <image bind:tap="load_tomorrow" src="../../resources/icons8-forward-64.png" class="icon-on-right"></image>

  <!-- if tmp date has schedule -->
  <block wx:if="{{hasSchedule}}">
    <!-- 下箭头 -->
    <image src="../../resources/icons8-double-down.gif" class="icon-double-down" bindtap="exit_subpage"></image>
    
    <!--地图容器-->
    <!-- 若将markers polyline等属性放在setting字典中: 实机测试时更新后不能自动渲染至map -->
    <view class="map-container">
      <map id="map" bindcallouttap="route_planning" setting="{{mapSetting}}" markers="{{listData}}"
      polyline="{{polyline}}">
      <cover-view slot="callout">
        <!-- 绑定marker-id -->
        <cover-view wx:for="{{listData}}" marker-id="{{item.sortKey}}" class="customCallout">{{item.sortKey+1}}
        </cover-view>
      </cover-view>
      <cover-view></cover-view>
    </map>
    </view>
  </block>

  <block wx:else>
      <image class="icon-add" src="../../resources/icons8-add-64.png" bind:tap="add_schedule"></image>
  </block>

</page-container>